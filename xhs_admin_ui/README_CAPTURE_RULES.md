# 抓取规则管理功能

## 概述

抓取规则管理功能为小红书评论系统提供了灵活的URL监控配置，允许管理员定义和管理插件需要监控的网络请求规则。

## 功能特性

### 1. 抓取规则管理
- **查看规则列表**: 显示所有抓取规则，包括启用状态、优先级等信息
- **创建新规则**: 支持添加新的URL匹配规则
- **编辑规则**: 修改现有规则的配置
- **删除规则**: 移除不需要的规则
- **启用/禁用规则**: 实时控制规则的激活状态

### 2. 网络数据监控
- **实时数据查看**: 监控插件抓取到的网络请求数据
- **统计仪表板**: 显示总请求数、今日请求数等统计信息
- **数据过滤**: 支持按规则名称、数据类型、时间范围筛选
- **详情查看**: 查看具体请求的详细信息和响应数据

## 页面说明

### 抓取规则管理页面 (`/system/capture-rules`)

#### 界面组件
- **规则列表表格**: 展示所有抓取规则
  - 规则名称
  - URL匹配模式 (支持通配符 *)
  - 数据类型 (评论、通知、用户、笔记等)
  - 优先级 (1-10，数字越大优先级越高)
  - 启用状态 (可直接切换)
  - 描述信息
  - 操作按钮 (编辑、删除)

- **添加/编辑对话框**: 创建或修改规则
  - 规则名称 (创建后不可修改)
  - URL匹配模式 (支持通配符)
  - 数据类型选择
  - 优先级设置
  - 描述文本
  - 启用状态开关

#### 操作流程
1. **查看规则**: 页面加载时自动获取所有规则
2. **添加规则**: 点击"添加规则"按钮，填写表单后提交
3. **编辑规则**: 点击规则行的"编辑"按钮，修改后保存
4. **删除规则**: 点击"删除"按钮，确认后删除
5. **切换状态**: 直接点击状态开关即可启用/禁用规则

### 网络数据监控页面 (`/system/network-data`)

#### 界面组件
- **统计卡片**: 显示关键指标
  - 总请求数
  - 今日请求数
  - 活跃规则数
  - 近1小时请求数

- **过滤工具栏**: 数据筛选功能
  - 规则名称下拉选择
  - 数据类型筛选
  - 时间范围选择
  - 刷新和导出按钮

- **数据表格**: 显示网络请求记录
  - 规则名称标签
  - 请求URL (长URL自动截断)
  - HTTP方法标签
  - 状态码标签
  - 数据大小
  - 接收时间
  - 操作按钮 (查看详情、查看响应)

- **详情对话框**: 显示请求的完整信息
  - 基本信息 (规则、类型、方法、状态码等)
  - 完整URL
  - 请求头信息
  - 响应数据 (JSON格式化显示)

## API接口

### 抓取规则管理接口

#### 1. 获取所有规则 (管理员)
```
GET /api/system/capture-rules/all
```

#### 2. 获取启用规则 (插件用)
```
GET /api/system/capture-rules
```

#### 3. 创建规则
```
POST /api/system/capture-rules
```

#### 4. 更新规则
```
PUT /api/system/capture-rules/{rule_name}
```

#### 5. 删除规则
```
DELETE /api/system/capture-rules/{rule_name}
```

### 网络数据接口

#### 1. 接收网络数据 (插件用)
```
POST /api/system/network-data
```

#### 2. 查询网络数据 (管理员)
```
GET /api/system/network-data
```

## 默认抓取规则

系统预设了以下默认抓取规则：

1. **通知接口**: `*/api/sns/web/v1/notify/*` (优先级: 10)
2. **评论接口**: `*/api/sns/web/v1/comment/*` (优先级: 10)
3. **用户信息接口**: `*/api/sns/web/v1/user/*` (优先级: 8)
4. **笔记内容接口**: `*/api/sns/web/v1/feed/*` (优先级: 9)
5. **搜索接口**: `*/api/sns/web/v1/search/*` (优先级: 5)
6. **热门推荐接口**: `*/api/sns/web/v1/homefeed/*` (优先级: 3)

## 使用建议

### 1. 规则设计原则
- **优先级设置**: 重要数据 (评论、通知) 设置高优先级
- **模式匹配**: 使用通配符 `*` 进行灵活匹配
- **描述规范**: 为每个规则添加清晰的描述

### 2. 监控策略
- **定期检查**: 定期查看网络数据监控页面
- **性能考虑**: 避免创建过于宽泛的匹配规则
- **数据分析**: 利用统计数据优化抓取策略

### 3. 维护建议
- **规则清理**: 定期清理不再需要的规则
- **性能监控**: 关注数据量和系统性能
- **权限控制**: 仅授权必要人员管理规则

## 故障排除

### 常见问题

1. **规则不生效**
   - 检查规则是否已启用
   - 确认URL匹配模式是否正确
   - 验证插件是否正确获取规则

2. **数据未接收**
   - 检查插件是否正常运行
   - 确认网络连接是否正常
   - 查看系统日志错误信息

3. **性能问题**
   - 检查规则数量是否过多
   - 优化URL匹配模式
   - 调整数据保留策略

### 日志查看
- 后端日志: 查看API调用和错误信息
- 插件日志: 查看数据抓取状态
- 数据库日志: 查看数据存储情况

## 开发说明

### 前端组件
- `CaptureRuleView.vue`: 抓取规则管理页面
- `NetworkDataView.vue`: 网络数据监控页面

### API服务
- `captureRuleApi`: 抓取规则管理API
- `networkDataApi`: 网络数据API

### 后端接口
- `system.py`: 系统管理相关接口实现

### 数据模型
- `CaptureRule`: 抓取规则模型
- `NetworkDataPayload`: 网络数据模型 