# 历史评论功能使用说明

## 功能概述

在 `xhs_plugin_v2` 中新增了【历史评论】功能，允许用户在小红书通知页面查看特定用户的所有历史评论信息。

## 功能特点

- ✅ 在通知列表中自动添加【历史评论】按钮
- ✅ 点击按钮弹出历史评论对话框
- ✅ 支持按笔记分组显示评论
- ✅ 评论树状结构显示（支持回复关系）
- ✅ 目标用户评论高亮显示
- ✅ 可拖拽的弹窗界面
- ✅ 优雅的加载动画和样式

## 使用方法

### 1. 访问通知页面
打开小红书通知页面：`https://www.xiaohongshu.com/notification`

### 2. 查看历史评论
- 在每个通知项的左侧会自动显示红色的【历史评论】按钮
- 点击按钮即可弹出该用户的历史评论对话框
- 对话框显示用户在不同笔记下的所有评论记录

### 3. 对话框功能
- **拖拽移动**：点击对话框标题栏可拖拽移动窗口位置
- **关闭对话框**：点击右上角的 × 按钮关闭
- **滚动查看**：对话框内容支持滚动查看更多评论
- **高亮显示**：目标用户的评论会以红色背景高亮显示

## 技术实现

### 核心模块

1. **API服务模块** (`injected/api-service.js`)
   - 处理与后端API的交互
   - 实现代理请求以避免CORS问题
   - 管理API配置获取

2. **对话框管理模块** (`injected/dialog-manager.js`)
   - 创建和管理历史评论弹窗
   - 渲染评论树状结构
   - 处理用户交互和拖拽功能

3. **通知处理模块** (`injected/notification-handler.js`)
   - 在通知列表中添加按钮
   - 监听DOM变化自动添加按钮
   - 提取用户信息和通知数据

### 数据流程

1. 用户点击【历史评论】按钮
2. 提取通知中的用户ID
3. 通过代理请求向后端API查询历史评论
4. 渲染评论数据到弹窗中显示

### API接口

使用的后端API端点：
- `GET /api/comments/user/{user_id}` - 获取用户历史评论

## 配置要求

### 插件配置
确保在插件选项中正确配置：
- **API地址**：后端服务器地址（默认：http://localhost:8000）
- **API令牌**：有效的认证令牌

### 权限配置
插件已配置必要权限：
- `<all_urls>` - 允许访问所有URL进行代理请求
- `webRequest` - 监听网络请求
- `storage` - 存储配置信息

## 错误处理

### 常见错误及解决方案

1. **无法获取用户信息**
   - 检查通知页面是否正常加载
   - 确认用户链接格式是否正确

2. **API请求失败**
   - 检查API地址和令牌配置
   - 确认后端服务是否运行正常
   - 查看控制台错误信息

3. **按钮不显示**
   - 刷新页面重试
   - 检查是否在正确的通知页面
   - 查看控制台是否有JavaScript错误

## 开发调试

### 控制台日志
所有模块都提供详细的控制台日志，使用不同前缀：
- `[XHS Plugin]` - 主插件信息
- `[API Service]` - API服务相关
- `[Dialog Manager]` - 对话框管理相关
- `[Notification Handler]` - 通知处理相关
- `[Background]` - 后台脚本相关
- `[Content]` - 内容脚本相关

### 调试建议
1. 打开浏览器开发者工具
2. 查看Console标签页的日志输出
3. 检查Network标签页的请求状态
4. 确认Extension页面插件是否正常加载

## 更新记录

### v1.0.0 (2024-01-XX)
- ✅ 初始版本发布
- ✅ 基础历史评论功能实现
- ✅ 通知页面按钮集成
- ✅ 弹窗对话框界面
- ✅ API代理请求机制

## 注意事项

1. **页面兼容性**：功能针对小红书通知页面开发，其他页面可能无法正常工作
2. **API依赖性**：需要配置正确的后端API地址和认证信息
3. **性能优化**：大量评论数据可能影响加载速度
4. **隐私保护**：所有数据请求都通过用户配置的API服务器

## 技术支持

如遇问题请：
1. 检查浏览器控制台错误信息
2. 确认插件和API配置正确
3. 查看相关日志输出定位问题 