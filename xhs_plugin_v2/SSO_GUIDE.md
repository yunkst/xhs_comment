# 小红书网络监控插件 - SSO登录与配置指南

**版本：v2.3.0**  
**更新日期：2024-12-01**

---

## 📋 目录

1. [功能概述](#功能概述)
2. [API配置](#api配置)
3. [SSO单点登录](#sso单点登录)
4. [抓取规则管理](#抓取规则管理)
5. [退出登录](#退出登录)
6. [常见问题](#常见问题)
7. [故障排除](#故障排除)

---

## 🌟 功能概述

### 主要功能

- **集中化抓取规则管理**：后端统一配置URL抓取规则，插件自动获取
- **单点登录 (SSO)**：通过后端统一认证系统进行登录
- **自动轮询检查**：SSO登录后自动检查登录状态，无需手动操作
- **实时网络监控**：根据后端配置的规则自动监控网络请求
- **数据自动上传**：符合规则的网络数据自动上传到后端

### v2.3.0 新特性

- ✅ **后端统一管理抓取规则**：移除插件端URL配置，改为从后端获取
- ✅ **规则自动同步**：API配置更新后自动刷新抓取规则
- ✅ **实时数据上传**：监控数据带规则名称自动上传
- ✅ **智能规则匹配**：支持优先级排序和通配符匹配

---

## ⚙️ API配置

### 配置步骤

1. **打开配置页面**
   - 点击插件图标 → 点击"⚙️ 配置"
   - 或右键插件图标 → 选择"选项"

2. **输入API服务器地址**
   ```
   示例：http://localhost:8000
   示例：https://api.example.com
   ```

3. **保存配置**
   - 点击"💾 保存API配置"按钮
   - 配置成功后会自动加载抓取规则

### 配置验证

- ✅ **地址格式**：必须以 `http://` 或 `https://` 开头
- ✅ **连接测试**：点击"🔗 测试连接"验证API可达性
- ✅ **规则加载**：配置成功后自动显示抓取规则信息

---

## 🔐 SSO单点登录

### 登录流程

1. **发起登录**
   - 确保已配置API服务器地址
   - 点击"🔐 单点登录 (SSO)"按钮
   - 系统会打开新标签页跳转到后端登录页面

2. **完成认证**
   - 在打开的页面中完成登录认证
   - 插件会自动开始轮询检查登录状态
   - 显示检查进度："正在检查登录状态 (1/60)"

3. **自动确认**
   - 插件每3秒检查一次登录状态
   - 最多检查3分钟（60次）
   - 登录成功后自动保存Token并显示成功提示

### 轮询检查特性

- **自动轮询**：无需手动点击"已完成登录"
- **实时进度**：显示检查次数和剩余时间
- **超时保护**：3分钟后自动停止，可手动重试
- **状态持久化**：浏览器重启后自动恢复检查状态

---

## 📋 抓取规则管理

### 规则概述

抓取规则由后端统一管理，插件自动获取并应用。每个规则包含：

- **规则名称**：如"通知接口"、"评论接口"等
- **URL模式**：支持通配符的URL匹配模式
- **数据类型**：notification、comment、note等
- **优先级**：数值越大优先级越高
- **启用状态**：是否启用此规则

### 默认规则

系统预设了以下抓取规则：

| 规则名称 | URL模式 | 数据类型 | 优先级 |
|----------|---------|----------|---------|
| 通知接口 | `*/api/sns/web/v1/notify/*` | notification | 10 |
| 评论接口 | `*/api/sns/web/v1/comment/*` | comment | 10 |
| 笔记内容接口 | `*/api/sns/web/v1/feed/*` | note | 9 |
| 用户信息接口 | `*/api/sns/web/v1/user/*` | user | 8 |
| 搜索接口 | `*/api/sns/web/v1/search/*` | search | 5 |
| 热门推荐接口 | `*/api/sns/web/v1/homefeed/*` | recommendation | 3 |

### 规则查看

1. **弹窗查看**
   - 点击插件图标
   - 查看"抓取规则"部分
   - 显示启用规则数量和详细列表

2. **配置页面查看**
   - 打开配置页面
   - 查看"抓取规则管理"部分
   - 显示所有规则的详细信息

### 规则刷新

- **自动刷新**：API配置更新后自动刷新
- **手动刷新**：点击"🔄 刷新规则"按钮
- **实时同步**：后端规则更新后可立即刷新获取

### 数据上传

当网络请求匹配抓取规则时：

1. **自动捕获**：插件自动捕获符合规则的网络请求
2. **规则标记**：上传数据时包含匹配的规则名称
3. **优先级匹配**：按优先级排序，使用第一个匹配的规则
4. **后端处理**：后端根据规则名称进行数据分类和处理

---

## 🚪 退出登录

### 退出方式

**方式一：弹窗退出**
1. 点击插件图标打开弹窗
2. 点击"🚪 退出登录"按钮
3. 确认退出操作

**方式二：配置页面退出**
1. 打开配置页面
2. 点击"🚪 退出登录"按钮
3. 确认退出操作

### 退出效果

- ✅ 清除本地存储的认证Token
- ✅ 保留API服务器地址配置
- ✅ 支持重新登录
- ✅ 同步更新所有页面状态

---

## ❓ 常见问题

### Q1: 没有抓取规则怎么办？

**A1:**
1. 检查API服务器地址是否正确配置
2. 确认API服务器正常运行
3. 点击"🔄 刷新规则"重新获取
4. 联系管理员在后端配置抓取规则

### Q2: 抓取规则不生效？

**A2:**
1. 确认规则状态为"已启用"
2. 检查URL模式是否正确匹配
3. 查看浏览器控制台是否有错误信息
4. 重启浏览器重新加载插件

### Q3: 数据没有上传到后端？

**A3:**
1. 确认已成功登录（有Token）
2. 检查网络请求是否匹配抓取规则
3. 查看控制台网络请求是否成功
4. 确认后端数据接收接口正常

### Q4: 如何添加新的抓取规则？

**A4:**
插件不支持添加规则，请：
1. 联系系统管理员
2. 在后端管理系统中添加新规则
3. 在插件中点击"🔄 刷新规则"获取更新

---

## 🔧 故障排除

### 连接问题

**症状**：无法连接到API服务器
**解决方案**：
1. 检查API地址格式（必须包含协议）
2. 确认服务器运行状态
3. 检查网络连接
4. 尝试在浏览器中直接访问API地址

### 登录问题

**症状**：SSO登录失败或超时
**解决方案**：
1. 确认后端SSO服务正常
2. 检查是否在3分钟内完成登录
3. 手动点击"✅ 已完成登录，点击继续"
4. 重新发起SSO登录

### 规则问题

**症状**：抓取规则不显示或不生效
**解决方案**：
1. 检查API配置是否正确
2. 确认后端有配置抓取规则
3. 手动刷新抓取规则
4. 重启浏览器重新加载插件

### 数据上传问题

**症状**：监控数据没有上传到后端
**解决方案**：
1. 确认已登录并有有效Token
2. 检查控制台中的网络请求日志
3. 确认访问的页面URL匹配抓取规则
4. 联系管理员检查后端数据接收状态

---

## 📞 技术支持

如果遇到其他问题，请提供以下信息：

1. **插件版本**：v2.3.0
2. **浏览器版本**：Chrome/Edge版本号
3. **API服务器地址**：（脱敏后的地址）
4. **错误信息**：控制台错误日志
5. **操作步骤**：重现问题的具体步骤

---

**更新历史**
- v2.3.0 (2024-12-01): 新增后端统一抓取规则管理功能
- v2.2.0 (2024-11-30): 新增退出登录功能
- v2.1.0 (2024-11-29): 新增自动轮询检查功能
- v2.0.0 (2024-11-28): 初始SSO登录功能