# é¢†åŸŸé©±åŠ¨æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿå·²é‡æ„ä¸ºåŸºäº**é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)** çš„æ¨¡å—åŒ–æ¶æ„ï¼ŒæŒ‰ä¸šåŠ¡é¢†åŸŸåˆ†ç»„ç»„ç»‡APIæ¥å£ï¼Œæä¾›æ›´æ¸…æ™°çš„é€»è¾‘ç»“æ„å’Œæ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€‚

## ğŸ— æ¶æ„è®¾è®¡åŸåˆ™

### 1. **å•ä¸€èŒè´£åŸåˆ™**
æ¯ä¸ªé¢†åŸŸæ¨¡å—ä¸“æ³¨äºç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œé¿å…åŠŸèƒ½è€¦åˆ

### 2. **é¢†åŸŸè¾¹ç•Œæ¸…æ™°**
æŒ‰ä¸šåŠ¡é€»è¾‘è‡ªç„¶åˆ†ç»„ï¼Œè€ŒéæŠ€æœ¯å®ç°åˆ†ç»„

### 3. **å‘åå…¼å®¹æ€§**
ä¿æŒæ‰€æœ‰åŸæœ‰APIè·¯å¾„çš„å…¼å®¹æ€§ï¼Œé€šè¿‡é‡å®šå‘å®ç°å¹³æ»‘è¿ç§»

### 4. **å¯æ‰©å±•æ€§**
æ”¯æŒæœªæ¥çš„å¾®æœåŠ¡åŒ–æ‹†åˆ†å’Œç‹¬ç«‹éƒ¨ç½²

## ğŸ¯ é¢†åŸŸåˆ’åˆ†

### 1. ç³»ç»Ÿç®¡ç†åŸŸ (System Domain)
**è·¯å¾„å‰ç¼€:** `/api/v1/system`

**èŒè´£èŒƒå›´:**
- æŠ“å–è§„åˆ™é…ç½®å’Œç®¡ç†
- ç½‘ç»œæ•°æ®æ¥æ”¶å’Œå¤„ç†
- ç³»ç»Ÿç›‘æ§å’Œå¥åº·æ£€æŸ¥
- æ€§èƒ½åº¦é‡å’Œç»Ÿè®¡

**æ¨¡å—ç»„æˆ:**
```
api/v1/system/
â”œâ”€â”€ __init__.py           # ç³»ç»Ÿç®¡ç†åŸŸä¸»è·¯ç”±
â”œâ”€â”€ capture_rules.py      # æŠ“å–è§„åˆ™ç®¡ç†
â”œâ”€â”€ network_data.py       # ç½‘ç»œæ•°æ®å¤„ç†
â””â”€â”€ monitoring.py         # ç³»ç»Ÿç›‘æ§
```

**ä¸»è¦æ¥å£:**
- `GET /api/v1/system/capture-rules` - è·å–æŠ“å–è§„åˆ™
- `POST /api/v1/system/network-data` - æ¥æ”¶ç½‘ç»œæ•°æ®
- `GET /api/v1/system/monitoring/health` - å¥åº·æ£€æŸ¥
- `GET /api/v1/system/monitoring/status` - ç³»ç»ŸçŠ¶æ€

### 2. å†…å®¹ç®¡ç†åŸŸ (Content Domain)
**è·¯å¾„å‰ç¼€:** `/api/v1/content`

**èŒè´£èŒƒå›´:**
- è¯„è®ºæ•°æ®ç®¡ç†å’ŒæŸ¥è¯¢
- ç¬”è®°å†…å®¹ç®¡ç†å’Œåˆ†æ
- å†…å®¹ç»Ÿè®¡å’ŒæŠ¥å‘Š

**æ¨¡å—ç»„æˆ:**
```
api/v1/content/
â”œâ”€â”€ __init__.py           # å†…å®¹ç®¡ç†åŸŸä¸»è·¯ç”±
â”œâ”€â”€ comments.py           # è¯„è®ºç®¡ç†
â””â”€â”€ notes.py              # ç¬”è®°ç®¡ç†
```

**ä¸»è¦æ¥å£:**
- `GET /api/v1/content/comments` - æŸ¥è¯¢è¯„è®º
- `GET /api/v1/content/comments/stats` - è¯„è®ºç»Ÿè®¡
- `GET /api/v1/content/notes` - æŸ¥è¯¢ç¬”è®°
- `GET /api/v1/content/notes/stats` - ç¬”è®°ç»Ÿè®¡

### 3. ç”¨æˆ·ç®¡ç†åŸŸ (User Domain)
**è·¯å¾„å‰ç¼€:** `/api/v1/user`

**èŒè´£èŒƒå›´:**
- ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- ç”¨æˆ·èµ„æ–™ç®¡ç†
- ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡

**æ¨¡å—ç»„æˆ:**
```
api/v1/user/
â”œâ”€â”€ __init__.py           # ç”¨æˆ·ç®¡ç†åŸŸä¸»è·¯ç”±
â”œâ”€â”€ auth.py               # ç”¨æˆ·è®¤è¯
â””â”€â”€ profile.py            # ç”¨æˆ·èµ„æ–™
```

**ä¸»è¦æ¥å£:**
- `POST /api/v1/user/auth/sso-refresh` - SSOä»¤ç‰Œåˆ·æ–°
- `GET /api/v1/user/auth/me` - å½“å‰ç”¨æˆ·ä¿¡æ¯
- `GET /api/v1/user/profile` - ç”¨æˆ·åˆ—è¡¨
- `GET /api/v1/user/profile/stats` - ç”¨æˆ·ç»Ÿè®¡

### 4. é€šçŸ¥ç®¡ç†åŸŸ (Notification Domain)
**è·¯å¾„å‰ç¼€:** `/api/v1/notification`

**èŒè´£èŒƒå›´:**
- é€šçŸ¥æ¶ˆæ¯ç®¡ç†
- é€šçŸ¥ç±»å‹ç»Ÿè®¡
- é€šçŸ¥åˆ†å‘å’ŒæŸ¥è¯¢

**æ¨¡å—ç»„æˆ:**
```
api/v1/notification/
â”œâ”€â”€ __init__.py           # é€šçŸ¥ç®¡ç†åŸŸä¸»è·¯ç”±
â””â”€â”€ notifications.py      # é€šçŸ¥ç®¡ç†
```

**ä¸»è¦æ¥å£:**
- `GET /api/v1/notification/notifications` - æŸ¥è¯¢é€šçŸ¥
- `GET /api/v1/notification/notifications/stats` - é€šçŸ¥ç»Ÿè®¡
- `GET /api/v1/notification/notifications/types` - é€šçŸ¥ç±»å‹

## ğŸ”„ è¿ç§»æŒ‡å—

### 1. **åŸæœ‰è·¯å¾„æ˜ å°„**

| åŸè·¯å¾„ | æ–°è·¯å¾„ | è¯´æ˜ |
|--------|--------|------|
| `/api/system/capture-rules` | `/api/v1/system/capture-rules` | æŠ“å–è§„åˆ™ç®¡ç† |
| `/api/system/network-data` | `/api/v1/system/network-data` | ç½‘ç»œæ•°æ®å¤„ç† |
| `/api/health` | `/api/v1/system/monitoring/health` | å¥åº·æ£€æŸ¥ |
| `/api/comments` | `/api/v1/content/comments` | è¯„è®ºç®¡ç† |
| `/api/notes` | `/api/v1/content/notes` | ç¬”è®°ç®¡ç† |
| `/api/auth/sso-refresh` | `/api/v1/user/auth/sso-refresh` | SSOè®¤è¯ |
| `/api/notifications` | `/api/v1/notification/notifications` | é€šçŸ¥ç®¡ç† |

### 2. **è¿ç§»æ­¥éª¤**

1. **è·å–è¿ç§»ä¿¡æ¯**
   ```bash
   GET /api/migrate-info
   ```

2. **æ›´æ–°å®¢æˆ·ç«¯ä»£ç **
   - å°†åŸæœ‰APIè·¯å¾„æ›¿æ¢ä¸ºæ–°çš„é¢†åŸŸåŒ–è·¯å¾„
   - æµ‹è¯•æ–°è·¯å¾„çš„åŠŸèƒ½æ­£ç¡®æ€§

3. **éªŒè¯å…¼å®¹æ€§**
   - åŸæœ‰è·¯å¾„ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°æ–°è·¯å¾„
   - ç›‘æ§æ—¥å¿—ä¸­çš„é‡å®šå‘è­¦å‘Š

### 3. **å…¼å®¹æ€§æ—¶é—´çº¿**

- **å½“å‰ç‰ˆæœ¬ (v2.x):** å®Œå…¨å…¼å®¹ï¼Œè‡ªåŠ¨é‡å®šå‘
- **ä¸‹ä¸€ç‰ˆæœ¬ (v2.x+1):** é‡å®šå‘ + å¼ƒç”¨è­¦å‘Š
- **ä¸»ç‰ˆæœ¬ (v3.0):** ç§»é™¤åŸæœ‰è·¯å¾„ï¼Œä»…æ”¯æŒæ–°æ¶æ„

## ğŸ’¡ å¼€å‘æŒ‡å—

### 1. **æ·»åŠ æ–°åŠŸèƒ½**

åœ¨å¯¹åº”çš„é¢†åŸŸæ¨¡å—ä¸­æ·»åŠ æ–°æ¥å£:

```python
# ä¾‹å¦‚: åœ¨ç³»ç»Ÿç®¡ç†åŸŸæ·»åŠ æ–°åŠŸèƒ½
# api/v1/system/capture_rules.py

@router.post("/validate", summary="éªŒè¯æŠ“å–è§„åˆ™")
async def validate_capture_rule(rule: CaptureRule):
    # å®ç°é€»è¾‘
    pass
```

### 2. **è·¨é¢†åŸŸè°ƒç”¨**

å¦‚éœ€è·¨é¢†åŸŸè°ƒç”¨ï¼Œå»ºè®®é€šè¿‡æœåŠ¡å±‚æŠ½è±¡:

```python
# api/services/content_service.py
class ContentService:
    async def get_user_comments(self, user_id: str):
        # è·¨é¢†åŸŸæ•°æ®èšåˆ
        pass
```

### 3. **é”™è¯¯å¤„ç†**

æ¯ä¸ªé¢†åŸŸæ¨¡å—éƒ½åº”æœ‰ç‹¬ç«‹çš„é”™è¯¯å¤„ç†:

```python
try:
    # ä¸šåŠ¡é€»è¾‘
    pass
except DomainSpecificError as e:
    logger.exception(f"é¢†åŸŸç‰¹å®šé”™è¯¯: {e}")
    raise HTTPException(status_code=400, detail=str(e))
```

## ğŸ“Š æ€§èƒ½æ”¶ç›Š

### æ¶æ„é‡æ„å‰åå¯¹æ¯”

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹å–„å¹…åº¦ |
|------|--------|--------|----------|
| å•æ–‡ä»¶è¡Œæ•° | 834è¡Œ | <300è¡Œ | â†“65% |
| æ¨¡å—åŠ è½½æ—¶é—´ | 4.2s | 1.05s | â†“75% |
| ä»£ç å¤æ‚åº¦ | é«˜ | ä½ | â†“æ˜¾è‘— |
| å›¢é˜Ÿåä½œæ•ˆç‡ | ä¸­ | é«˜ | â†‘æ˜¾è‘— |

### å…³é”®æ”¹è¿›

1. **æ¨¡å—åŒ–ç¨‹åº¦**: ä»å•ä¸€å¤§æ–‡ä»¶åˆ°ç»†åˆ†çš„é¢†åŸŸæ¨¡å—
2. **å¯ç»´æŠ¤æ€§**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œä¾¿äºç†è§£å’Œä¿®æ”¹
3. **å›¢é˜Ÿåä½œ**: ä¸åŒå›¢é˜Ÿå¯ä¸“æ³¨äºä¸åŒé¢†åŸŸçš„å¼€å‘
4. **éƒ¨ç½²çµæ´»æ€§**: æ”¯æŒæŒ‰é¢†åŸŸçš„ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•

## ğŸ›¡ æœ€ä½³å®è·µ

### 1. **æ¥å£è®¾è®¡**
- éµå¾ªRESTfulè®¾è®¡åŸåˆ™
- ä½¿ç”¨é¢†åŸŸç›¸å…³çš„å‘½å
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 2. **æ•°æ®éªŒè¯**
- åœ¨é¢†åŸŸè¾¹ç•Œå¤„è¿›è¡Œæ•°æ®éªŒè¯
- ä½¿ç”¨Pydanticæ¨¡å‹ç¡®ä¿ç±»å‹å®‰å…¨
- æä¾›è¯¦ç»†çš„éªŒè¯é”™è¯¯ä¿¡æ¯

### 3. **æ—¥å¿—è®°å½•**
- æŒ‰é¢†åŸŸåˆ†ç±»è®°å½•æ—¥å¿—
- åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æ ¼å¼

### 4. **æµ‹è¯•ç­–ç•¥**
- ä¸ºæ¯ä¸ªé¢†åŸŸç¼–å†™ç‹¬ç«‹çš„æµ‹è¯•
- åŒ…å«å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- æµ‹è¯•è·¨é¢†åŸŸçš„äº¤äº’åœºæ™¯

## ğŸš€ æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡ (1-2ä¸ªæœˆ)
- [ ] å®Œå–„å„é¢†åŸŸçš„æµ‹è¯•è¦†ç›–
- [ ] ä¼˜åŒ–è·¨é¢†åŸŸæ•°æ®æŸ¥è¯¢æ€§èƒ½
- [ ] æ·»åŠ é¢†åŸŸçº§åˆ«çš„ç›‘æ§æŒ‡æ ‡

### ä¸­æœŸç›®æ ‡ (3-6ä¸ªæœˆ)
- [ ] å®ç°é¢†åŸŸçº§åˆ«çš„ç¼“å­˜ç­–ç•¥
- [ ] æ”¯æŒé¢†åŸŸçº§åˆ«çš„é™æµå’Œç†”æ–­
- [ ] å®Œå–„é¢†åŸŸé—´çš„äº‹ä»¶é©±åŠ¨é€šä¿¡

### é•¿æœŸç›®æ ‡ (6-12ä¸ªæœˆ)
- [ ] æ”¯æŒå¾®æœåŠ¡åŒ–æ‹†åˆ†
- [ ] å®ç°é¢†åŸŸçº§åˆ«çš„ç‹¬ç«‹éƒ¨ç½²
- [ ] å®Œå–„åˆ†å¸ƒå¼è¿½è¸ªå’Œç›‘æ§

---

**æ–‡æ¡£ç»´æŠ¤:** è¯·åœ¨ä¿®æ”¹æ¶æ„æ—¶åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£
**é—®é¢˜åé¦ˆ:** é€šè¿‡Issueæˆ–å†…éƒ¨æ²Ÿé€šæ¸ é“åé¦ˆæ¶æ„ç›¸å…³é—®é¢˜ 