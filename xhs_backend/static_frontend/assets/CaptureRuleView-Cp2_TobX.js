import{_ as W,a as v,J as k,r as X,o as Y,c as Z,i,b as t,w as l,j as ee,f as te,k as ae,K as V,E as d,e as r,g as M,h as s,t as p,m as le}from"./index-Bxk-Wkve.js";const oe={class:"capture-rule-view"},ne={class:"toolbar"},re={class:"toolbar-right"},se={class:"table-container"},ie={class:"dialog-footer"},ue={__name:"CaptureRuleView",setup(de){const C=v(!1),h=v(!1),w=v([]),_=v(!1),c=v(!1),b=v(),B=k(()=>w.value.length),D=k(()=>w.value.filter(o=>o.enabled).length),T=k(()=>c.value?"编辑抓取规则":"添加抓取规则"),n=X({name:"",pattern:"",data_type:"",priority:5,description:"",enabled:!0}),$={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:2,max:50,message:"规则名称长度在 2 到 50 个字符",trigger:"blur"}],pattern:[{required:!0,message:"请输入URL匹配模式",trigger:"blur"},{min:5,message:"URL匹配模式至少5个字符",trigger:"blur"}],data_type:[{required:!0,message:"请选择数据类型",trigger:"change"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur"}]},E=o=>({comment:"primary",notification:"success",user:"info",note:"warning",search:"",recommendation:"danger",other:""})[o]||"",q=o=>({comment:"评论",notification:"通知",user:"用户",note:"笔记",search:"搜索",recommendation:"推荐",other:"其他"})[o]||o,F=o=>o>=8?"danger":o>=5?"warning":"info",x=async()=>{C.value=!0;try{const o=await V.getAllCaptureRules();o.success&&(w.value=o.rules.map(e=>({...e,updating:!1})))}catch(o){d.error("获取抓取规则失败："+o.message)}finally{C.value=!1}},j=()=>{c.value=!1,N(),_.value=!0},A=o=>{c.value=!0,Object.assign(n,o),_.value=!0},N=()=>{Object.assign(n,{name:"",pattern:"",data_type:"",priority:5,description:"",enabled:!0}),b.value&&b.value.clearValidate()},S=async()=>{if(!(!b.value||!await b.value.validate().catch(()=>!1))){h.value=!0;try{c.value?(await V.updateCaptureRule(n.name,n),d.success("更新规则成功")):(await V.createCaptureRule(n),d.success("创建规则成功")),_.value=!1,await x()}catch(e){d.error((c.value?"更新":"创建")+"规则失败："+e.message)}finally{h.value=!1}}},z=async o=>{const e=!o.enabled;o.updating=!0;try{await V.updateCaptureRule(o.name,o),d.success(`规则已${o.enabled?"启用":"禁用"}`)}catch(u){o.enabled=e,d.error("更新规则状态失败："+u.message)}finally{o.updating=!1}},O=async o=>{try{await le.confirm(`确定要删除规则 "${o.name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await V.deleteCaptureRule(o.name),d.success("删除规则成功"),await x()}catch(e){e!=="cancel"&&d.error("删除规则失败："+e.message)}};return Y(()=>{x()}),(o,e)=>{const u=r("el-button"),y=r("el-text"),m=r("el-table-column"),P=r("el-tag"),L=r("el-switch"),I=r("el-table"),U=r("el-input"),g=r("el-form-item"),f=r("el-option"),J=r("el-select"),K=r("el-input-number"),G=r("el-form"),H=r("el-dialog"),Q=te("loading");return M(),Z("div",oe,[e[15]||(e[15]=i("div",{class:"page-header"},[i("h2",null,"抓取规则管理"),i("p",{class:"page-description"},"管理URL抓取规则，控制插件监控的网络请求")],-1)),i("div",ne,[t(u,{type:"primary",icon:"Plus",onClick:j},{default:l(()=>e[8]||(e[8]=[s(" 添加规则 ")])),_:1}),t(u,{icon:"Refresh",onClick:x},{default:l(()=>e[9]||(e[9]=[s(" 刷新 ")])),_:1}),i("div",re,[t(y,{class:"stats-text"},{default:l(()=>[s(" 共 "+p(B.value)+" 条规则，启用 "+p(D.value)+" 条 ",1)]),_:1})])]),i("div",se,[ee((M(),ae(I,{data:w.value,stripe:"",border:"",style:{width:"100%"}},{default:l(()=>[t(m,{prop:"name",label:"规则名称",width:"150"},{default:l(({row:a})=>[t(y,null,{default:l(()=>[s(p(a.name),1)]),_:2},1024)]),_:1}),t(m,{prop:"pattern",label:"URL匹配模式","min-width":"200"},{default:l(({row:a})=>[t(y,{class:"pattern-text"},{default:l(()=>[s(p(a.pattern),1)]),_:2},1024)]),_:1}),t(m,{prop:"data_type",label:"数据类型",width:"120"},{default:l(({row:a})=>[t(P,{type:E(a.data_type)},{default:l(()=>[s(p(q(a.data_type)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"priority",label:"优先级",width:"100",align:"center"},{default:l(({row:a})=>[t(y,{type:F(a.priority)},{default:l(()=>[s(p(a.priority),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[t(L,{modelValue:a.enabled,"onUpdate:modelValue":R=>a.enabled=R,onChange:R=>z(a),loading:a.updating},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),t(m,{prop:"description",label:"描述","min-width":"150"},{default:l(({row:a})=>[t(y,{class:"description-text"},{default:l(()=>[s(p(a.description||"无描述"),1)]),_:2},1024)]),_:1}),t(m,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[t(u,{type:"primary",text:"",size:"small",onClick:R=>A(a)},{default:l(()=>e[10]||(e[10]=[s(" 编辑 ")])),_:2},1032,["onClick"]),t(u,{type:"danger",text:"",size:"small",onClick:R=>O(a)},{default:l(()=>e[11]||(e[11]=[s(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,C.value]])]),t(H,{title:T.value,modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a),width:"600px","close-on-click-modal":!1},{footer:l(()=>[i("span",ie,[t(u,{onClick:e[6]||(e[6]=a=>_.value=!1)},{default:l(()=>e[14]||(e[14]=[s("取消")])),_:1}),t(u,{type:"primary",onClick:S,loading:h.value},{default:l(()=>[s(p(c.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:l(()=>[t(G,{ref_key:"ruleFormRef",ref:b,model:n,rules:$,"label-width":"120px"},{default:l(()=>[t(g,{label:"规则名称",prop:"name"},{default:l(()=>[t(U,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),placeholder:"请输入规则名称",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),t(g,{label:"URL匹配模式",prop:"pattern"},{default:l(()=>[t(U,{modelValue:n.pattern,"onUpdate:modelValue":e[1]||(e[1]=a=>n.pattern=a),placeholder:"例如: */api/sns/web/v1/comment/*",type:"textarea",rows:2},null,8,["modelValue"]),e[12]||(e[12]=i("div",{class:"form-tip"}," 支持通配符 *，用于匹配URL路径 ",-1))]),_:1}),t(g,{label:"数据类型",prop:"data_type"},{default:l(()=>[t(J,{modelValue:n.data_type,"onUpdate:modelValue":e[2]||(e[2]=a=>n.data_type=a),placeholder:"请选择数据类型"},{default:l(()=>[t(f,{label:"评论",value:"comment"}),t(f,{label:"通知",value:"notification"}),t(f,{label:"用户",value:"user"}),t(f,{label:"笔记",value:"note"}),t(f,{label:"搜索",value:"search"}),t(f,{label:"推荐",value:"recommendation"}),t(f,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"优先级",prop:"priority"},{default:l(()=>[t(K,{modelValue:n.priority,"onUpdate:modelValue":e[3]||(e[3]=a=>n.priority=a),min:1,max:10,placeholder:"1-10，数字越大优先级越高"},null,8,["modelValue"]),e[13]||(e[13]=i("div",{class:"form-tip"}," 1-10之间的数字，数字越大优先级越高 ",-1))]),_:1}),t(g,{label:"描述"},{default:l(()=>[t(U,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=a=>n.description=a),placeholder:"请输入规则描述",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(g,{label:"启用状态"},{default:l(()=>[t(L,{modelValue:n.enabled,"onUpdate:modelValue":e[5]||(e[5]=a=>n.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},ce=W(ue,[["__scopeId","data-v-011536b5"]]);export{ce as default};
