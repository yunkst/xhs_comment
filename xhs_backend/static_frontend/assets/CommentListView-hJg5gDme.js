import{_ as G,r as x,a as h,o as H,c as T,b as t,w as a,d as i,e as J,E as N,f as K,g as w,h as s,i as f,j as Q,k as y,t as m,l as W}from"./index-Bxx4aJ0I.js";const X={class:"comment-list-container"},Z={class:"table-header"},ee={class:"table-operations"},te={class:"pagination-container"},ae={style:{"white-space":"pre-wrap"}},le={key:1},oe={class:"dialog-footer"},ne={__name:"CommentListView",setup(se){const d=x({keyword:"",dateRange:[]}),S={shortcuts:[{text:"最近一周",onClick(l){const e=new Date,o=new Date;o.setTime(o.getTime()-3600*1e3*24*7),l.$emit("pick",[o,e])}},{text:"最近一个月",onClick(l){const e=new Date,o=new Date;o.setTime(o.getTime()-3600*1e3*24*30),l.$emit("pick",[o,e])}},{text:"最近三个月",onClick(l){const e=new Date,o=new Date;o.setTime(o.getTime()-3600*1e3*24*90),l.$emit("pick",[o,e])}}]},D=h(!1),b=h([]),R=h([]),c=x({currentPage:1,pageSize:10,total:0}),k=h(!1),r=h({}),g=async()=>{var l,e;D.value=!0;try{const o={page:c.currentPage,page_size:c.pageSize,keyword:d.keyword||void 0};d.dateRange&&d.dateRange.length===2&&(o.startDate=d.dateRange[0],o.endDate=d.dateRange[1]);const u=await J.getCommentList(o);u&&u.items?(b.value=u.items,c.total=u.total):(N.error(u.message||"获取评论列表失败，数据格式不正确"),b.value=[],c.total=0)}catch(o){console.error("获取评论列表失败:",o);const u=((e=(l=o.response)==null?void 0:l.data)==null?void 0:e.detail)||o.message||"获取评论列表失败";N.error(u),b.value=[],c.total=0}finally{D.value=!1}},C=l=>{if(!l)return"-";try{const e=new Date(l);return isNaN(e.getTime())?l:e.toLocaleString("zh-CN",{hour12:!1})}catch{return l}},V=()=>{c.currentPage=1,g()},Y=()=>{d.keyword="",d.dateRange=[],V()},L=()=>{g()},M=l=>{R.value=l},P=l=>{r.value={...l},k.value=!0},$=l=>{c.pageSize=l,c.currentPage=1,g()},B=l=>{c.currentPage=l,g()};return H(()=>{g()}),(l,e)=>{const o=i("el-input"),u=i("el-form-item"),j=i("el-date-picker"),v=i("el-button"),A=i("el-form"),I=i("el-card"),p=i("el-table-column"),z=i("el-avatar"),E=i("el-table"),U=i("el-pagination"),_=i("el-descriptions-item"),O=i("el-descriptions"),F=i("el-dialog"),q=K("loading");return w(),T("div",X,[t(I,{class:"search-card"},{default:a(()=>[t(A,{inline:!0,model:d,class:"search-form"},{default:a(()=>[t(u,{label:"关键词"},{default:a(()=>[t(o,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>d.keyword=n),placeholder:"评论内容/作者名/作者ID/笔记ID",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{label:"评论时间范围"},{default:a(()=>[t(j,{modelValue:d.dateRange,"onUpdate:modelValue":e[1]||(e[1]=n=>d.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","picker-options":S},null,8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(v,{type:"primary",onClick:V},{default:a(()=>e[4]||(e[4]=[s("搜索")])),_:1}),t(v,{onClick:Y},{default:a(()=>e[5]||(e[5]=[s("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(I,{class:"table-card"},{default:a(()=>[f("div",Z,[e[7]||(e[7]=f("h3",null,"评论列表",-1)),f("div",ee,[t(v,{onClick:L},{default:a(()=>e[6]||(e[6]=[s("刷新")])),_:1})])]),Q((w(),y(E,{data:b.value,style:{width:"100%"},onSelectionChange:M},{default:a(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"authorId",label:"作者ID",width:"220"}),t(p,{label:"作者头像",width:"100"},{default:a(n=>[t(z,{size:40,src:n.row.authorAvatar},{default:a(()=>e[8]||(e[8]=[f("img",{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"},null,-1)])),_:2},1032,["src"])]),_:1}),t(p,{prop:"authorName",label:"作者名称",width:"150"}),t(p,{prop:"content",label:"评论内容","min-width":"250","show-overflow-tooltip":""}),t(p,{prop:"noteId",label:"笔记ID",width:"220"}),t(p,{prop:"timestamp",label:"评论时间",width:"180"},{default:a(n=>[s(m(C(n.row.timestamp)),1)]),_:1}),t(p,{prop:"fetchTimestamp",label:"获取时间",width:"180"},{default:a(n=>[s(m(C(n.row.fetchTimestamp)),1)]),_:1}),t(p,{label:"操作",width:"100",fixed:"right"},{default:a(n=>[t(v,{size:"small",onClick:re=>P(n.row)},{default:a(()=>e[9]||(e[9]=[s("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,D.value]]),f("div",te,[t(U,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":c.currentPage,"page-sizes":[10,20,50,100],"page-size":c.pageSize,total:c.total,onSizeChange:$,onCurrentChange:B},null,8,["current-page","page-size","total"])])]),_:1}),t(F,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=n=>k.value=n),title:"评论详情",width:"600px"},{footer:a(()=>[f("div",oe,[t(v,{onClick:e[2]||(e[2]=n=>k.value=!1)},{default:a(()=>e[12]||(e[12]=[s("关闭")])),_:1})])]),default:a(()=>[r.value&&Object.keys(r.value).length>0?(w(),y(O,{key:0,column:1,border:""},{default:a(()=>[t(_,{label:"评论ID"},{default:a(()=>[s(m(r.value.commentId),1)]),_:1}),t(_,{label:"作者ID"},{default:a(()=>[s(m(r.value.authorId),1)]),_:1}),t(_,{label:"作者名称"},{default:a(()=>[s(m(r.value.authorName),1)]),_:1}),t(_,{label:"作者头像"},{default:a(()=>[t(z,{size:60,src:r.value.authorAvatar},{default:a(()=>e[10]||(e[10]=[f("img",{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"},null,-1)])),_:1},8,["src"])]),_:1}),t(_,{label:"笔记ID"},{default:a(()=>[s(m(r.value.noteId),1)]),_:1}),t(_,{label:"评论内容"},{default:a(()=>[f("div",ae,m(r.value.content),1)]),_:1}),t(_,{label:"评论时间"},{default:a(()=>[s(m(C(r.value.timestamp)),1)]),_:1}),t(_,{label:"获取时间"},{default:a(()=>[s(m(C(r.value.fetchTimestamp)),1)]),_:1}),r.value.repliedId?(w(),y(_,{key:0,label:"回复评论ID"},{default:a(()=>[s(m(r.value.repliedId),1)]),_:1})):W("",!0)]),_:1})):(w(),T("div",le,e[11]||(e[11]=[f("p",null,"暂无评论详情",-1)])))]),_:1},8,["modelValue"])])}}},de=G(ne,[["__scopeId","data-v-3944fa65"]]);export{de as default};
