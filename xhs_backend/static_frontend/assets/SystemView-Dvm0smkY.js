import{_ as ue,a as c,r as de,o as ce,c as H,b as t,w as a,s as p,E as u,e as i,f as me,g as y,j as M,k,l as A,h as g,i as o,u as P,p as pe,q as fe,v as _e,t as _,m as G}from"./index-eMZQhuFX.js";const ve={class:"system-container"},ye={class:"backup-actions"},ge={class:"backup-history"},be={class:"system-monitoring"},we={class:"status-item"},ke={class:"status-item"},Ve={class:"status-item"},Le={class:"status-item"},xe={class:"status-item"},Se={class:"status-item"},Be={class:"status-item"},Ce={class:"status-item"},Te={class:"status-item"},Ee={__name:"SystemView",setup(Ue){const T=c(!1),E=c(!1),U=c(!1),D=c(!1),F=c(!1),h=c(!1),r=de({passwordExpiration:90,loginLockEnabled:!0,loginLockThreshold:5,loginLockTime:30,sessionTimeout:120}),j=c({}),z=c([]),w=c(null),b=c([]),V=c({}),L=c({}),x=c({}),J=async()=>{var n,e;T.value=!0;try{const l=await p.getSystemSettings();l&&l.data&&(Object.assign(r,l.data),j.value={...l.data})}catch(l){console.error("加载系统设置失败:",l),u.error(((e=(n=l.response)==null?void 0:n.data)==null?void 0:e.detail)||"加载系统设置失败")}finally{T.value=!1}},K=async()=>{var n,e;E.value=!0;try{await p.updateSystemSettings(r),j.value={...r},u.success("安全设置保存成功")}catch(l){console.error("保存安全设置失败:",l),u.error(((e=(n=l.response)==null?void 0:n.data)==null?void 0:e.detail)||"保存安全设置失败")}finally{E.value=!1}},Q=()=>{Object.assign(r,j.value),u.info("安全设置已重置")},q=async()=>{var n,e;F.value=!0;try{const l=await p.getBackupHistory();l&&l.data&&(b.value=l.data.map(s=>({...s,downloading:!1})))}catch(l){console.error("加载备份历史失败:",l),u.error(((e=(n=l.response)==null?void 0:n.data)==null?void 0:e.detail)||"加载备份历史失败"),b.value=[]}finally{F.value=!1}},W=async()=>{var n,e;U.value=!0;try{const l=await p.backupData();u.success("数据备份成功"),await q()}catch(l){console.error("数据备份失败:",l),u.error(((e=(n=l.response)==null?void 0:n.data)==null?void 0:e.detail)||"数据备份失败")}finally{U.value=!1}},X=n=>{z.value=[n],w.value=n},Y=async()=>{var n,e;if(!w.value){u.warning("请先选择备份文件");return}try{await G.confirm("恢复操作将覆盖当前数据，是否继续?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.value=!0;const l=new FormData;l.append("file",w.value.raw),await p.restoreData(l),z.value=[],w.value=null,u.success("数据恢复成功"),await I()}catch(l){l!=="cancel"&&(console.error("数据恢复失败:",l),u.error(((e=(n=l.response)==null?void 0:n.data)==null?void 0:e.detail)||"数据恢复失败"))}finally{D.value=!1}},Z=async n=>{var e,l;n.downloading=!0;try{const s=await p.downloadBackup(n.filename),m=new Blob([s],{type:"application/octet-stream"}),S=window.URL.createObjectURL(m),f=document.createElement("a");f.href=S,f.download=n.filename,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(S),u.success(`备份文件 ${n.filename} 下载成功`)}catch(s){console.error("下载备份文件失败:",s),u.error(((l=(e=s.response)==null?void 0:e.data)==null?void 0:l.detail)||"下载备份文件失败")}finally{n.downloading=!1}},ee=async n=>{var e,l;try{await G.confirm(`确定要删除备份文件 ${n.filename} 吗?`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await p.deleteBackup(n.filename),b.value=b.value.filter(s=>s.filename!==n.filename),u.success("备份文件删除成功")}catch(s){s!=="cancel"&&(console.error("删除备份文件失败:",s),u.error(((l=(e=s.response)==null?void 0:e.data)==null?void 0:l.detail)||"删除备份文件失败"))}},I=async()=>{var n,e;h.value=!0;try{const[l,s,m]=await Promise.all([p.getSystemStatus(),p.getDatabaseStats(),p.getVersionInfo()]);V.value=(l==null?void 0:l.data)||{},L.value=(s==null?void 0:s.data)||{},x.value=(m==null?void 0:m.data)||{}}catch(l){console.error("加载系统信息失败:",l),u.error(((e=(n=l.response)==null?void 0:n.data)==null?void 0:e.detail)||"加载系统信息失败")}finally{h.value=!1}};return ce(async()=>{await Promise.all([J(),q(),I()])}),(n,e)=>{const l=i("el-option"),s=i("el-select"),m=i("el-form-item"),S=i("el-switch"),f=i("el-input-number"),v=i("el-button"),le=i("el-form"),N=i("el-tab-pane"),te=i("el-alert"),O=i("el-icon"),ae=i("el-upload"),B=i("el-table-column"),oe=i("el-table"),ne=i("el-empty"),C=i("el-card"),R=i("el-col"),se=i("el-row"),ie=i("el-tabs"),$=me("loading");return y(),H("div",ve,[t(C,{class:"system-card"},{header:a(()=>e[5]||(e[5]=[o("div",{class:"card-header"},[o("h3",null,"系统设置")],-1)])),default:a(()=>[t(ie,{type:"border-card"},{default:a(()=>[t(N,{label:"安全设置"},{default:a(()=>[M((y(),k(le,{model:r,"label-width":"180px"},{default:a(()=>[t(m,{label:"登录密码有效期"},{default:a(()=>[t(s,{modelValue:r.passwordExpiration,"onUpdate:modelValue":e[0]||(e[0]=d=>r.passwordExpiration=d)},{default:a(()=>[t(l,{label:"永不过期",value:0}),t(l,{label:"30天",value:30}),t(l,{label:"60天",value:60}),t(l,{label:"90天",value:90})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"登录失败锁定"},{default:a(()=>[t(S,{modelValue:r.loginLockEnabled,"onUpdate:modelValue":e[1]||(e[1]=d=>r.loginLockEnabled=d)},null,8,["modelValue"])]),_:1}),r.loginLockEnabled?(y(),k(m,{key:0,label:"失败次数锁定阈值"},{default:a(()=>[t(f,{modelValue:r.loginLockThreshold,"onUpdate:modelValue":e[2]||(e[2]=d=>r.loginLockThreshold=d),min:1,max:10},null,8,["modelValue"])]),_:1})):A("",!0),r.loginLockEnabled?(y(),k(m,{key:1,label:"锁定时间(分钟)"},{default:a(()=>[t(f,{modelValue:r.loginLockTime,"onUpdate:modelValue":e[3]||(e[3]=d=>r.loginLockTime=d),min:1,max:1440},null,8,["modelValue"])]),_:1})):A("",!0),t(m,{label:"会话超时时间(分钟)"},{default:a(()=>[t(f,{modelValue:r.sessionTimeout,"onUpdate:modelValue":e[4]||(e[4]=d=>r.sessionTimeout=d),min:1,max:1440},null,8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(v,{type:"primary",onClick:K,loading:E.value},{default:a(()=>e[6]||(e[6]=[g("保存设置")])),_:1},8,["loading"]),t(v,{onClick:Q},{default:a(()=>e[7]||(e[7]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[$,T.value]])]),_:1}),t(N,{label:"备份恢复"},{default:a(()=>[t(te,{title:"数据备份与恢复",type:"info",closable:!1,description:"您可以备份系统数据或恢复之前的备份，请谨慎操作以免数据丢失。","show-icon":"",style:{"margin-bottom":"20px"}}),o("div",ye,[t(v,{type:"primary",onClick:W,loading:U.value},{default:a(()=>[t(O,null,{default:a(()=>[t(P(pe))]),_:1}),e[8]||(e[8]=g(" 备份数据 "))]),_:1},8,["loading"]),t(ae,{class:"upload-backup",action:"#","auto-upload":!1,"on-change":X,"file-list":z.value,accept:".zip,.sql,.bak"},{default:a(()=>[t(v,{type:"warning"},{default:a(()=>[t(O,null,{default:a(()=>[t(P(fe))]),_:1}),e[9]||(e[9]=g(" 选择备份文件 "))]),_:1})]),_:1},8,["file-list"]),t(v,{type:"danger",onClick:Y,disabled:!w.value,loading:D.value},{default:a(()=>[t(O,null,{default:a(()=>[t(P(_e))]),_:1}),e[10]||(e[10]=g(" 恢复数据 "))]),_:1},8,["disabled","loading"])]),M((y(),H("div",ge,[e[13]||(e[13]=o("h4",null,"备份历史",-1)),b.value.length>0?(y(),k(oe,{key:0,data:b.value,style:{width:"100%"}},{default:a(()=>[t(B,{prop:"filename",label:"文件名"}),t(B,{prop:"size",label:"大小",width:"120"}),t(B,{prop:"createTime",label:"创建时间",width:"180"}),t(B,{label:"操作",width:"180"},{default:a(d=>[t(v,{size:"small",onClick:re=>Z(d.row),loading:d.row.downloading},{default:a(()=>e[11]||(e[11]=[g("下载")])),_:2},1032,["onClick","loading"]),t(v,{size:"small",type:"danger",onClick:re=>ee(d.row)},{default:a(()=>e[12]||(e[12]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(y(),k(ne,{key:1,description:"暂无备份历史"}))])),[[$,F.value]])]),_:1}),t(N,{label:"系统监控"},{default:a(()=>[M((y(),H("div",be,[t(se,{gutter:20},{default:a(()=>[t(R,{span:8},{default:a(()=>[t(C,null,{default:a(()=>[e[17]||(e[17]=o("h4",null,"系统状态",-1)),o("div",we,[e[14]||(e[14]=o("span",null,"运行时间:",-1)),o("span",null,_(V.value.uptime||"-"),1)]),o("div",ke,[e[15]||(e[15]=o("span",null,"CPU使用率:",-1)),o("span",null,_(V.value.cpu_usage||"-"),1)]),o("div",Ve,[e[16]||(e[16]=o("span",null,"内存使用率:",-1)),o("span",null,_(V.value.memory_usage||"-"),1)])]),_:1})]),_:1}),t(R,{span:8},{default:a(()=>[t(C,null,{default:a(()=>[e[21]||(e[21]=o("h4",null,"数据库统计",-1)),o("div",Le,[e[18]||(e[18]=o("span",null,"评论总数:",-1)),o("span",null,_(L.value.comments_count||"-"),1)]),o("div",xe,[e[19]||(e[19]=o("span",null,"用户总数:",-1)),o("span",null,_(L.value.users_count||"-"),1)]),o("div",Se,[e[20]||(e[20]=o("span",null,"数据库大小:",-1)),o("span",null,_(L.value.database_size||"-"),1)])]),_:1})]),_:1}),t(R,{span:8},{default:a(()=>[t(C,null,{default:a(()=>[e[25]||(e[25]=o("h4",null,"版本信息",-1)),o("div",Be,[e[22]||(e[22]=o("span",null,"系统版本:",-1)),o("span",null,_(x.value.version||"-"),1)]),o("div",Ce,[e[23]||(e[23]=o("span",null,"构建时间:",-1)),o("span",null,_(x.value.build_time||"-"),1)]),o("div",Te,[e[24]||(e[24]=o("span",null,"Git提交:",-1)),o("span",null,_(x.value.git_commit||"-"),1)])]),_:1})]),_:1})]),_:1}),t(v,{type:"primary",onClick:I,style:{"margin-top":"20px"}},{default:a(()=>e[26]||(e[26]=[g("刷新系统信息")])),_:1})])),[[$,h.value]])]),_:1})]),_:1})]),_:1})])}}},Fe=ue(Ee,[["__scopeId","data-v-e8a02278"]]);export{Fe as default};
