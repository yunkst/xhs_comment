import{_ as oe,r as $,a as k,o as le,c as R,b as t,w as l,d as y,E as d,e as i,f as se,g as I,h as c,i as v,j as re,k as Y,t as p,l as A,m as T}from"./index-eMZQhuFX.js";const ce={class:"comment-list-container"},de={class:"table-header"},ie={class:"table-operations"},ue={class:"comment-content"},me={class:"table-footer"},pe={class:"batch-actions"},_e={class:"pagination-container"},ge={key:0,class:"comment-detail"},fe={class:"comment-content-detail"},ve={class:"dialog-footer"},he={__name:"CommentListView",setup(we){const u=$({keyword:"",dateRange:[]}),M={shortcuts:[{text:"最近一周",onClick(a){const e=new Date,n=new Date;n.setTime(n.getTime()-3600*1e3*24*7),a.$emit("pick",[n,e])}},{text:"最近一个月",onClick(a){const e=new Date,n=new Date;n.setTime(n.getTime()-3600*1e3*24*30),a.$emit("pick",[n,e])}},{text:"最近三个月",onClick(a){const e=new Date,n=new Date;n.setTime(n.getTime()-3600*1e3*24*90),a.$emit("pick",[n,e])}}]},V=k(!1),D=k([]),_=k([]),m=$({currentPage:1,pageSize:10,total:0}),C=k(!1),s=k({}),g=async()=>{var a,e;V.value=!0;try{const n={page:m.currentPage,page_size:m.pageSize,keyword:u.keyword||void 0};u.dateRange&&u.dateRange.length===2&&(n.startDate=u.dateRange[0],n.endDate=u.dateRange[1]);const o=await y.getCommentList(n);o&&o.items?(D.value=o.items,m.total=o.total):(d.error(o.message||"获取评论列表失败，数据格式不正确"),D.value=[],m.total=0)}catch(n){console.error("获取评论列表失败:",n);const o=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.detail)||n.message||"获取评论列表失败";d.error(o),D.value=[],m.total=0}finally{V.value=!1}},x=a=>{if(!a)return"-";try{const e=new Date(a);return isNaN(e.getTime())?a:e.toLocaleString("zh-CN",{hour12:!1})}catch{return a}},L=a=>{switch(a){case"通过":return"success";case"拦截":return"danger";case"待审核":return"warning";default:return"info"}},S=()=>{m.currentPage=1,g()},P=()=>{u.keyword="",u.dateRange=[],S()},U=()=>{g()},E=a=>{_.value=a},j=a=>{s.value={...a},C.value=!0},F=async()=>{var e,n;if(_.value.length===0){d.warning("请先选择要操作的评论");return}const a=_.value.map(o=>o.commentId||o.id);try{await T.confirm(`确定要批量通过这 ${_.value.length} 条评论吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.batchUpdateStatus(a,"通过"),d.success("批量通过成功"),g()}catch(o){o!=="cancel"&&(console.error("批量通过失败:",o),d.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.detail)||"批量通过失败"))}},O=async()=>{var e,n;if(_.value.length===0){d.warning("请先选择要删除的评论");return}const a=_.value.map(o=>o.commentId||o.id);try{await T.confirm(`确定要批量删除这 ${_.value.length} 条评论吗？此操作不可恢复。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await y.batchDelete(a),d.success("批量删除成功"),g()}catch(o){o!=="cancel"&&(console.error("批量删除失败:",o),d.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.detail)||"批量删除失败"))}},q=async a=>{var n,o;const e=a.commentId||a.id;try{await y.updateCommentStatus(e,"通过"),d.success("评论通过成功"),g()}catch(h){console.error("评论通过失败:",h),d.error(((o=(n=h.response)==null?void 0:n.data)==null?void 0:o.detail)||"评论通过失败")}},G=async a=>{var n,o;const e=a.commentId||a.id;try{await T.confirm("确定要删除这条评论吗？此操作不可恢复。","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await y.deleteComment(e),d.success("评论删除成功"),g()}catch(h){h!=="cancel"&&(console.error("评论删除失败:",h),d.error(((o=(n=h.response)==null?void 0:n.data)==null?void 0:o.detail)||"评论删除失败"))}},H=async()=>{var e,n;if(!s.value||!(s.value.commentId||s.value.id)){d.error("评论信息无效");return}const a=s.value.commentId||s.value.id;try{await y.updateCommentStatus(a,s.value.status),d.success("评论状态更新成功"),C.value=!1,g()}catch(o){console.error("评论状态更新失败:",o),d.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.detail)||"评论状态更新失败")}},J=a=>{m.pageSize=a,m.currentPage=1,g()},K=a=>{m.currentPage=a,g()};return le(()=>{g()}),(a,e)=>{const n=i("el-input"),o=i("el-form-item"),h=i("el-date-picker"),f=i("el-button"),Q=i("el-form"),B=i("el-card"),b=i("el-table-column"),W=i("el-tag"),X=i("el-table"),Z=i("el-pagination"),w=i("el-descriptions-item"),z=i("el-option"),ee=i("el-select"),te=i("el-descriptions"),ae=i("el-dialog"),ne=se("loading");return I(),R("div",ce,[t(B,{class:"search-card"},{default:l(()=>[t(Q,{inline:!0,model:u,class:"search-form"},{default:l(()=>[t(o,{label:"关键词"},{default:l(()=>[t(n,{modelValue:u.keyword,"onUpdate:modelValue":e[0]||(e[0]=r=>u.keyword=r),placeholder:"评论内容/作者名/作者ID/笔记ID",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"评论时间范围"},{default:l(()=>[t(h,{modelValue:u.dateRange,"onUpdate:modelValue":e[1]||(e[1]=r=>u.dateRange=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","picker-options":M},null,8,["modelValue"])]),_:1}),t(o,null,{default:l(()=>[t(f,{type:"primary",onClick:S},{default:l(()=>e[5]||(e[5]=[c("搜索")])),_:1}),t(f,{onClick:P},{default:l(()=>e[6]||(e[6]=[c("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(B,{class:"table-card"},{default:l(()=>[v("div",de,[e[8]||(e[8]=v("h3",null,"评论列表",-1)),v("div",ie,[t(f,{onClick:U},{default:l(()=>e[7]||(e[7]=[c("刷新")])),_:1})])]),re((I(),Y(X,{data:D.value,style:{width:"100%"},onSelectionChange:E},{default:l(()=>[t(b,{type:"selection",width:"55"}),t(b,{prop:"commentId",label:"评论ID",width:"200"}),t(b,{prop:"content",label:"评论内容",width:"300"},{default:l(r=>[v("div",ue,p(r.row.content),1)]),_:1}),t(b,{prop:"userId",label:"用户ID",width:"150"}),t(b,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(r=>[c(p(x(r.row.createdAt)),1)]),_:1}),t(b,{prop:"status",label:"状态",width:"100"},{default:l(r=>[t(W,{type:L(r.row.status)},{default:l(()=>[c(p(r.row.status||"待审核"),1)]),_:2},1032,["type"])]),_:1}),t(b,{label:"操作",width:"200",fixed:"right"},{default:l(r=>[t(f,{size:"small",onClick:N=>j(r.row)},{default:l(()=>e[9]||(e[9]=[c("查看")])),_:2},1032,["onClick"]),r.row.status!=="通过"?(I(),Y(f,{key:0,size:"small",type:"success",onClick:N=>q(r.row)},{default:l(()=>e[10]||(e[10]=[c("通过")])),_:2},1032,["onClick"])):A("",!0),t(f,{size:"small",type:"danger",onClick:N=>G(r.row)},{default:l(()=>e[11]||(e[11]=[c("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,V.value]]),v("div",me,[v("div",pe,[t(f,{type:"success",onClick:F,disabled:_.value.length===0},{default:l(()=>[c(" 批量通过 ("+p(_.value.length)+") ",1)]),_:1},8,["disabled"]),t(f,{type:"danger",onClick:O,disabled:_.value.length===0},{default:l(()=>[c(" 批量删除 ("+p(_.value.length)+") ",1)]),_:1},8,["disabled"])])]),v("div",_e,[t(Z,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":m.currentPage,"page-sizes":[10,20,50,100],"page-size":m.pageSize,total:m.total,onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),_:1}),t(ae,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=r=>C.value=r),title:"评论详情",width:"600px"},{footer:l(()=>[v("span",ve,[t(f,{onClick:e[3]||(e[3]=r=>C.value=!1)},{default:l(()=>e[12]||(e[12]=[c("取消")])),_:1}),t(f,{type:"primary",onClick:H},{default:l(()=>e[13]||(e[13]=[c("保存状态")])),_:1})])]),default:l(()=>[s.value?(I(),R("div",ge,[t(te,{column:1,border:""},{default:l(()=>[t(w,{label:"评论ID"},{default:l(()=>[c(p(s.value.commentId||s.value.id),1)]),_:1}),t(w,{label:"用户ID"},{default:l(()=>[c(p(s.value.userId||s.value.authorId),1)]),_:1}),t(w,{label:"用户名称"},{default:l(()=>[c(p(s.value.userName||s.value.authorName||"-"),1)]),_:1}),t(w,{label:"评论内容"},{default:l(()=>[v("div",fe,p(s.value.content),1)]),_:1}),t(w,{label:"笔记ID"},{default:l(()=>[c(p(s.value.noteId||"-"),1)]),_:1}),t(w,{label:"创建时间"},{default:l(()=>[c(p(x(s.value.createdAt||s.value.timestamp)),1)]),_:1}),t(w,{label:"获取时间"},{default:l(()=>[c(p(x(s.value.fetchTimestamp||s.value.updatedAt)),1)]),_:1}),t(w,{label:"当前状态"},{default:l(()=>[t(ee,{modelValue:s.value.status,"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.status=r),placeholder:"选择状态"},{default:l(()=>[t(z,{label:"待审核",value:"待审核"}),t(z,{label:"通过",value:"通过"}),t(z,{label:"拦截",value:"拦截"})]),_:1},8,["modelValue"])]),_:1})]),_:1})])):A("",!0)]),_:1},8,["modelValue"])])}}},ye=oe(he,[["__scopeId","data-v-0942b332"]]);export{ye as default};
