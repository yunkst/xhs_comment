import{_ as te,a as f,r as O,o as ae,c as M,i as o,b as e,w as a,d as u,j as le,f as se,k as P,y as oe,E as S,g as x,t as r,u as D,z as ne,A as re,B as ie,C as de,F as ue,D as ce,h as n,l as _e}from"./index-B90Amhi_.js";const pe={class:"network-data-view"},fe={class:"stats-grid"},me={class:"stats-content"},ve={class:"stats-number"},ge={class:"stats-content"},be={class:"stats-number"},ye={class:"stats-content"},he={class:"stats-number"},we={class:"stats-content"},ke={class:"stats-number"},xe={class:"filter-toolbar"},ze={class:"filter-left"},De={class:"filter-right"},Ve={class:"table-container"},Ce={class:"pagination-container"},Me={key:0,class:"detail-content"},Se={class:"detail-section"},Be={class:"detail-section"},Ne={__name:"NetworkDataView",setup(Ue){const V=f(!1),C=f(!1),B=f([]),w=f(!1),d=f(null),N=f([]),U=f(0),R=f(0),Y=f(0),E=f(0),i=O({rule_name:"",data_type:"",date_range:[]}),v=O({page:1,pageSize:20,total:0}),q=l=>l?l.length>60?l.substring(0,57)+"...":l:"",T=l=>({GET:"success",POST:"primary",PUT:"warning",DELETE:"danger",PATCH:"info"})[l]||"",H=l=>l>=200&&l<300?"success":l>=300&&l<400?"info":l>=400&&l<500?"warning":l>=500?"danger":"",L=l=>{if(!l)return"0 B";const t=1024,m=["B","KB","MB","GB"],p=Math.floor(Math.log(l)/Math.log(t));return parseFloat((l/Math.pow(t,p)).toFixed(2))+" "+m[p]},F=l=>l?new Date(l).toLocaleString("zh-CN"):"",A=l=>{if(!l)return"";try{return JSON.stringify(typeof l=="string"?JSON.parse(l):l,null,2)}catch{return l}},g=async()=>{var l,t,m,p;V.value=!0;try{const c={page:v.page,page_size:v.pageSize,...i};i.date_range&&i.date_range.length===2&&(c.start_time=i.date_range[0],c.end_time=i.date_range[1]);const _=await oe.getNetworkData(c);_.success&&(B.value=_.data||[],v.total=_.total||0,U.value=((l=_.stats)==null?void 0:l.total)||0,R.value=((t=_.stats)==null?void 0:t.today)||0,Y.value=((m=_.stats)==null?void 0:m.active_rules)||0,E.value=((p=_.stats)==null?void 0:p.recent_hour)||0,_.available_rules&&(N.value=_.available_rules))}catch(c){S.error("获取网络数据失败："+(c.message||c))}finally{V.value=!1}},$=l=>{d.value=l,w.value=!0},j=l=>{d.value=l,w.value=!0},G=async()=>{C.value=!0;try{const l={...i,export:!0};i.date_range&&i.date_range.length===2&&(l.start_time=i.date_range[0],l.end_time=i.date_range[1]),S.success("导出功能开发中...")}catch(l){S.error("导出失败："+l.message)}finally{C.value=!1}};return ae(()=>{g()}),(l,t)=>{const m=u("el-icon"),p=u("el-card"),c=u("el-option"),_=u("el-select"),I=u("el-date-picker"),k=u("el-button"),b=u("el-tag"),y=u("el-table-column"),z=u("el-text"),K=u("el-table"),Q=u("el-pagination"),h=u("el-descriptions-item"),W=u("el-descriptions"),J=u("el-input"),X=u("el-dialog"),Z=se("loading");return x(),M("div",pe,[t[19]||(t[19]=o("div",{class:"page-header"},[o("h2",null,"网络数据监控"),o("p",{class:"page-description"},"监控插件抓取到的网络请求数据，实时查看数据采集情况")],-1)),o("div",fe,[e(p,{class:"stats-card"},{default:a(()=>[o("div",me,[o("div",ve,r(U.value),1),t[8]||(t[8]=o("div",{class:"stats-label"},"总请求数",-1))]),e(m,{class:"stats-icon primary"},{default:a(()=>[e(D(ne))]),_:1})]),_:1}),e(p,{class:"stats-card"},{default:a(()=>[o("div",ge,[o("div",be,r(R.value),1),t[9]||(t[9]=o("div",{class:"stats-label"},"今日请求数",-1))]),e(m,{class:"stats-icon success"},{default:a(()=>[e(D(re))]),_:1})]),_:1}),e(p,{class:"stats-card"},{default:a(()=>[o("div",ye,[o("div",he,r(Y.value),1),t[10]||(t[10]=o("div",{class:"stats-label"},"活跃规则数",-1))]),e(m,{class:"stats-icon info"},{default:a(()=>[e(D(ie))]),_:1})]),_:1}),e(p,{class:"stats-card"},{default:a(()=>[o("div",we,[o("div",ke,r(E.value),1),t[11]||(t[11]=o("div",{class:"stats-label"},"近1小时请求",-1))]),e(m,{class:"stats-icon warning"},{default:a(()=>[e(D(de))]),_:1})]),_:1})]),o("div",xe,[o("div",ze,[e(_,{modelValue:i.rule_name,"onUpdate:modelValue":t[0]||(t[0]=s=>i.rule_name=s),placeholder:"选择规则",clearable:"",style:{width:"200px"},onChange:g},{default:a(()=>[(x(!0),M(ue,null,ce(N.value,s=>(x(),P(c,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(_,{modelValue:i.data_type,"onUpdate:modelValue":t[1]||(t[1]=s=>i.data_type=s),placeholder:"数据类型",clearable:"",style:{width:"150px"},onChange:g},{default:a(()=>[e(c,{label:"评论",value:"comment"}),e(c,{label:"通知",value:"notification"}),e(c,{label:"用户",value:"user"}),e(c,{label:"笔记",value:"note"}),e(c,{label:"搜索",value:"search"}),e(c,{label:"推荐",value:"recommendation"})]),_:1},8,["modelValue"]),e(I,{modelValue:i.date_range,"onUpdate:modelValue":t[2]||(t[2]=s=>i.date_range=s),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",onChange:g,style:{width:"350px"}},null,8,["modelValue"])]),o("div",De,[e(k,{icon:"Refresh",onClick:g},{default:a(()=>t[12]||(t[12]=[n("刷新")])),_:1}),e(k,{icon:"Download",onClick:G,loading:C.value},{default:a(()=>t[13]||(t[13]=[n(" 导出 ")])),_:1},8,["loading"])])]),o("div",Ve,[le((x(),P(K,{data:B.value,stripe:"",border:"",style:{width:"100%"},height:500},{default:a(()=>[e(y,{prop:"rule_name",label:"规则名称",width:"120"},{default:a(({row:s})=>[e(b,{size:"small"},{default:a(()=>[n(r(s.rule_name),1)]),_:2},1024)]),_:1}),e(y,{prop:"url",label:"请求URL","min-width":"250"},{default:a(({row:s})=>[e(z,{class:"url-text",title:s.url},{default:a(()=>[n(r(q(s.url)),1)]),_:2},1032,["title"])]),_:1}),e(y,{prop:"method",label:"方法",width:"80",align:"center"},{default:a(({row:s})=>[e(b,{type:T(s.method),size:"small"},{default:a(()=>[n(r(s.method),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"status_code",label:"状态码",width:"100",align:"center"},{default:a(({row:s})=>[e(b,{type:H(s.status_code),size:"small"},{default:a(()=>[n(r(s.status_code),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"data_size",label:"数据大小",width:"100",align:"center"},{default:a(({row:s})=>[e(z,null,{default:a(()=>[n(r(L(s.data_size)),1)]),_:2},1024)]),_:1}),e(y,{prop:"received_at",label:"接收时间",width:"160"},{default:a(({row:s})=>[e(z,null,{default:a(()=>[n(r(F(s.received_at)),1)]),_:2},1024)]),_:1}),e(y,{label:"操作",width:"150",fixed:"right"},{default:a(({row:s})=>[e(k,{type:"primary",text:"",size:"small",onClick:ee=>$(s)},{default:a(()=>t[14]||(t[14]=[n(" 查看详情 ")])),_:2},1032,["onClick"]),e(k,{type:"info",text:"",size:"small",onClick:ee=>j(s)},{default:a(()=>t[15]||(t[15]=[n(" 查看响应 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,V.value]]),o("div",Ce,[e(Q,{"current-page":v.page,"onUpdate:currentPage":t[3]||(t[3]=s=>v.page=s),"page-size":v.pageSize,"onUpdate:pageSize":t[4]||(t[4]=s=>v.pageSize=s),"page-sizes":[10,20,50,100],total:v.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])])]),e(X,{title:"网络请求详情",modelValue:w.value,"onUpdate:modelValue":t[7]||(t[7]=s=>w.value=s),width:"800px","close-on-click-modal":!1},{footer:a(()=>[e(k,{onClick:t[6]||(t[6]=s=>w.value=!1)},{default:a(()=>t[18]||(t[18]=[n("关闭")])),_:1})]),default:a(()=>[d.value?(x(),M("div",Me,[e(W,{column:2,border:""},{default:a(()=>[e(h,{label:"规则名称"},{default:a(()=>[e(b,null,{default:a(()=>[n(r(d.value.rule_name),1)]),_:1})]),_:1}),e(h,{label:"数据类型"},{default:a(()=>[e(b,{type:"info"},{default:a(()=>[n(r(d.value.data_type),1)]),_:1})]),_:1}),e(h,{label:"请求方法"},{default:a(()=>[e(b,{type:T(d.value.method)},{default:a(()=>[n(r(d.value.method),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"状态码"},{default:a(()=>[e(b,{type:H(d.value.status_code)},{default:a(()=>[n(r(d.value.status_code),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"数据大小"},{default:a(()=>[n(r(L(d.value.data_size)),1)]),_:1}),e(h,{label:"接收时间"},{default:a(()=>[n(r(F(d.value.received_at)),1)]),_:1}),e(h,{label:"请求URL",span:2},{default:a(()=>[e(z,{class:"url-full"},{default:a(()=>[n(r(d.value.url),1)]),_:1})]),_:1})]),_:1}),o("div",Se,[t[16]||(t[16]=o("h4",null,"请求头",-1)),e(J,{modelValue:d.value.headers,"onUpdate:modelValue":t[5]||(t[5]=s=>d.value.headers=s),type:"textarea",rows:6,readonly:"",placeholder:"无请求头数据"},null,8,["modelValue"])]),o("div",Be,[t[17]||(t[17]=o("h4",null,"响应数据",-1)),e(J,{"model-value":A(d.value.response_data),type:"textarea",rows:10,readonly:"",placeholder:"无响应数据"},null,8,["model-value"])])])):_e("",!0)]),_:1},8,["modelValue"])])}}},Ye=te(Ne,[["__scopeId","data-v-923bfcd0"]]);export{Ye as default};
