import{_ as W,r as N,a as w,o as X,c as I,b as t,w as a,d as z,E as g,e as i,f as Z,g as k,h as r,i as _,j as ee,t as c,k as R,l as T,m as Y}from"./index-Dztj2Ft2.js";const te={class:"comment-list-container"},ae={class:"table-header"},le={class:"table-operations"},ne={class:"author-info"},oe={style:{"margin-left":"10px"}},se={class:"comment-content"},re={class:"pagination-container"},ie={key:0,class:"comment-detail"},de={class:"comment-content-detail"},ce={class:"dialog-footer"},ue={__name:"CommentListView",setup(me){const d=N({keyword:"",dateRange:[]}),D=w(!1),y=w([]),h=w([]),u=N({currentPage:1,pageSize:10,total:0}),C=w(!1),m=w(null),f=async()=>{var o,e;D.value=!0;try{const l={page:u.currentPage,page_size:u.pageSize,keyword:d.keyword||void 0};d.dateRange&&d.dateRange.length===2&&(l.startDate=d.dateRange[0],l.endDate=d.dateRange[1]);const n=await z.getCommentList(l);n&&n.items?(y.value=n.items,u.total=n.total,g.success(`成功获取 ${n.items.length} 条评论数据。`)):(g.error(n.message||"获取评论列表失败，数据格式不正确"),y.value=[],u.total=0)}catch(l){console.error("获取评论列表失败:",l);const n=((e=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:e.detail)||l.message||"获取评论列表失败";g.error(n),y.value=[],u.total=0}finally{D.value=!1}},V=o=>{if(!o)return"N/A";const e=new Date(o);return isNaN(e.getTime())?"Invalid Date":e.toLocaleString()},S=()=>{u.currentPage=1,f()},M=()=>{d.keyword="",d.dateRange=[],S()},L=()=>{f()},P=o=>{h.value=o},$=o=>{m.value=o,C.value=!0},A=async o=>{var e,l;await Y.confirm("确定要删除这条评论吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await z.deleteComment(o._id),g.success("删除成功"),f()}catch(n){const x=((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.detail)||"删除失败";g.error(x)}},E=async()=>{var o,e;if(h.value.length===0){g.warning("请先选择要删除的评论");return}await Y.confirm(`确定要删除选中的 ${h.value.length} 条评论吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{const l=h.value.map(n=>n._id);await z.batchDelete(l),g.success("批量删除成功"),f()}catch(l){const n=((e=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:e.detail)||"批量删除失败";g.error(n)}},U=o=>{u.pageSize=o,f()},j=o=>{u.currentPage=o,f()};return X(()=>{f()}),(o,e)=>{const l=i("el-input"),n=i("el-form-item"),x=i("el-date-picker"),v=i("el-button"),F=i("el-form"),B=i("el-card"),b=i("el-table-column"),J=i("el-avatar"),O=i("el-table"),q=i("el-pagination"),p=i("el-descriptions-item"),G=i("el-descriptions"),H=i("el-dialog"),K=Z("loading");return k(),I("div",te,[t(B,{class:"search-card"},{default:a(()=>[t(F,{inline:!0,model:d,class:"search-form"},{default:a(()=>[t(n,{label:"关键词"},{default:a(()=>[t(l,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=s=>d.keyword=s),placeholder:"评论内容/作者名/作者ID/笔记ID",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{label:"评论时间范围"},{default:a(()=>[t(x,{modelValue:d.dateRange,"onUpdate:modelValue":e[1]||(e[1]=s=>d.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(n,null,{default:a(()=>[t(v,{type:"primary",onClick:S},{default:a(()=>e[4]||(e[4]=[r("搜索")])),_:1,__:[4]}),t(v,{onClick:M},{default:a(()=>e[5]||(e[5]=[r("重置")])),_:1,__:[5]})]),_:1})]),_:1},8,["model"])]),_:1}),t(B,{class:"table-card"},{default:a(()=>[_("div",ae,[e[7]||(e[7]=_("h3",null,"评论列表",-1)),_("div",le,[t(v,{onClick:L},{default:a(()=>e[6]||(e[6]=[r("刷新")])),_:1,__:[6]}),t(v,{type:"danger",onClick:E,disabled:h.value.length===0},{default:a(()=>[r(" 批量删除 ("+c(h.value.length)+") ",1)]),_:1},8,["disabled"])])]),ee((k(),R(O,{data:y.value,style:{width:"100%"},onSelectionChange:P},{default:a(()=>[t(b,{type:"selection",width:"55"}),t(b,{prop:"authorAvatar",label:"作者",width:"120"},{default:a(s=>[_("div",ne,[t(J,{src:s.row.authorAvatar,size:"small"},null,8,["src"]),_("span",oe,c(s.row.authorName),1)])]),_:1}),t(b,{prop:"content",label:"评论内容","min-width":"300"},{default:a(s=>[_("div",se,c(s.row.content),1)]),_:1}),t(b,{prop:"timestamp",label:"评论时间",width:"180"},{default:a(s=>[r(c(V(s.row.timestamp)),1)]),_:1}),t(b,{label:"操作",width:"150",fixed:"right"},{default:a(s=>[t(v,{size:"small",onClick:Q=>$(s.row)},{default:a(()=>e[8]||(e[8]=[r("查看详情")])),_:2,__:[8]},1032,["onClick"]),t(v,{size:"small",type:"danger",onClick:Q=>A(s.row)},{default:a(()=>e[9]||(e[9]=[r("删除")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,D.value]]),_("div",re,[t(q,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":u.currentPage,"page-sizes":[10,20,50,100],"page-size":u.pageSize,total:u.total,onSizeChange:U,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1}),t(H,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=s=>C.value=s),title:"评论详情",width:"600px"},{footer:a(()=>[_("span",ce,[t(v,{onClick:e[2]||(e[2]=s=>C.value=!1)},{default:a(()=>e[10]||(e[10]=[r("关闭")])),_:1,__:[10]})])]),default:a(()=>[m.value?(k(),I("div",ie,[t(G,{column:1,border:""},{default:a(()=>[t(p,{label:"评论ID"},{default:a(()=>[r(c(m.value.id),1)]),_:1}),t(p,{label:"作者ID"},{default:a(()=>[r(c(m.value.authorId),1)]),_:1}),t(p,{label:"作者名称"},{default:a(()=>[r(c(m.value.authorName||"-"),1)]),_:1}),t(p,{label:"评论内容"},{default:a(()=>[_("div",de,c(m.value.content),1)]),_:1}),t(p,{label:"所属笔记ID"},{default:a(()=>[r(c(m.value.noteId||"-"),1)]),_:1}),t(p,{label:"评论时间"},{default:a(()=>[r(c(V(m.value.timestamp)),1)]),_:1}),t(p,{label:"数据获取时间"},{default:a(()=>[r(c(V(m.value.fetchTimestamp)),1)]),_:1}),m.value.target_comment?(k(),R(p,{key:0,label:"被回复的评论"},{default:a(()=>[_("pre",null,c(JSON.stringify(m.value.target_comment,null,2)),1)]),_:1})):T("",!0)]),_:1})])):T("",!0)]),_:1},8,["modelValue"])])}}},pe=W(ue,[["__scopeId","data-v-6bff77b6"]]);export{pe as default};
