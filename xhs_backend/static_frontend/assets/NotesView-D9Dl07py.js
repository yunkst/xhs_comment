import{_ as ae,a as N,r as Y,o as oe,c as M,b as e,w as t,n as A,E as T,e as u,f as se,g as k,i as s,u as h,p as ne,t as i,q as ie,s as de,v as re,j as ue,h as d,y as _e,z as ce,k as U,A as F,B as fe,C as pe,l as S}from"./index-Dztj2Ft2.js";const me={class:"notes-view"},ge={class:"stats-content"},ve={class:"stats-icon notes"},he={class:"stats-info"},ye={class:"stats-value"},we={class:"stats-content"},be={class:"stats-icon today"},ke={class:"stats-info"},Ce={class:"stats-value"},Ve={class:"stats-content"},xe={class:"stats-icon likes"},Ie={class:"stats-info"},Ne={class:"stats-value"},De={class:"stats-content"},ze={class:"stats-icon comments"},Pe={class:"stats-info"},Se={class:"stats-value"},Le={class:"card-header"},Ye={class:"header-actions"},Me={class:"note-title"},Te={class:"author-info"},Ue={key:0,class:"note-detail"},Be={key:0,class:"note-illegal-section"},je={__name:"NotesView",setup(Ee){const C=N(!1),V=N([]),y=N([]),D=N(!1),r=N(null),g=Y({totalNotes:0,todayNotes:0,totalLikes:0,totalComments:0}),_=Y({noteId:"",author:"",keyword:""}),f=Y({currentPage:1,pageSize:20,total:0}),w=async()=>{var a,l;C.value=!0;try{const n={page:f.currentPage,page_size:f.pageSize};_.noteId&&(n.noteId=_.noteId),_.author&&(n.authorName=_.author),_.keyword&&(n.keyword=_.keyword),y.value&&y.value.length===2&&(n.startDate=y.value[0],n.endDate=y.value[1]);const c=await A.getNoteList(n);c.success?(V.value=c.data||[],f.total=c.total||0):c.items?(V.value=c.items||[],f.total=c.total||0):(V.value=[],f.total=0,T.warning(c.message||"获取笔记列表失败"))}catch(n){console.error("获取笔记列表失败:",n),T.error(((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.detail)||n.message||"获取笔记列表失败"),V.value=[],f.total=0}finally{C.value=!1}},B=async()=>{var a,l,n,c;try{const p=await A.getNotesStats();p.success&&p.stats&&(g.totalNotes=((a=p.stats.total)==null?void 0:a.notes)||0,g.todayNotes=((l=p.stats.period)==null?void 0:l.today)||0,g.totalLikes=((n=p.stats.engagement)==null?void 0:n.total_liked)||0,g.totalComments=((c=p.stats.engagement)==null?void 0:c.total_collected)||0)}catch(p){console.error("获取统计信息失败:",p)}},q=()=>{f.currentPage=1,w()},G=()=>{_.noteId="",_.author="",_.keyword="",y.value=[],f.currentPage=1,w()},H=async()=>{await Promise.all([w(),B()]),T.success("数据已刷新")},J=a=>{f.currentPage=a,w()},K=a=>{f.pageSize=a,f.currentPage=1,w()},j=a=>{r.value=a,D.value=!0},O=a=>{j(a)},z=a=>{if(!a)return"-";try{const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return a}},P=a=>a==null?"0":a>=1e4?(a/1e4).toFixed(1)+"w":a>=1e3?(a/1e3).toFixed(1)+"k":a.toString(),E=a=>`https://www.xiaohongshu.com/explore/${a}`;return oe(()=>{w(),B()}),(a,l)=>{const n=u("el-icon"),c=u("el-card"),p=u("el-col"),Q=u("el-row"),x=u("el-button"),L=u("el-input"),I=u("el-form-item"),W=u("el-date-picker"),X=u("el-form"),R=u("el-link"),v=u("el-table-column"),b=u("el-tag"),Z=u("el-table"),ee=u("el-pagination"),m=u("el-descriptions-item"),$=u("el-descriptions"),te=u("el-dialog"),le=se("loading");return k(),M("div",me,[e(Q,{gutter:20,class:"stats-row"},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(c,{class:"stats-card"},{default:t(()=>[s("div",ge,[s("div",ve,[e(n,null,{default:t(()=>[e(h(ne))]),_:1})]),s("div",he,[l[7]||(l[7]=s("div",{class:"stats-title"},"总笔记数",-1)),s("div",ye,i(g.totalNotes||0),1)])])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(c,{class:"stats-card"},{default:t(()=>[s("div",we,[s("div",be,[e(n,null,{default:t(()=>[e(h(ie))]),_:1})]),s("div",ke,[l[8]||(l[8]=s("div",{class:"stats-title"},"今日新增",-1)),s("div",Ce,i(g.todayNotes||0),1)])])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(c,{class:"stats-card"},{default:t(()=>[s("div",Ve,[s("div",xe,[e(n,null,{default:t(()=>[e(h(de))]),_:1})]),s("div",Ie,[l[9]||(l[9]=s("div",{class:"stats-title"},"总点赞数",-1)),s("div",Ne,i(g.totalLikes||0),1)])])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(c,{class:"stats-card"},{default:t(()=>[s("div",De,[s("div",ze,[e(n,null,{default:t(()=>[e(h(re))]),_:1})]),s("div",Pe,[l[10]||(l[10]=s("div",{class:"stats-title"},"总评论数",-1)),s("div",Se,i(g.totalComments||0),1)])])]),_:1})]),_:1})]),_:1}),e(c,{class:"main-card"},{header:t(()=>[s("div",Le,[l[12]||(l[12]=s("span",null,"小红书笔记管理",-1)),s("div",Ye,[e(x,{type:"primary",onClick:H,loading:C.value},{default:t(()=>[e(n,null,{default:t(()=>[e(h(pe))]),_:1}),l[11]||(l[11]=d(" 刷新 "))]),_:1,__:[11]},8,["loading"])])])]),default:t(()=>[e(X,{inline:!0,model:_,class:"search-form"},{default:t(()=>[e(I,{label:"笔记ID"},{default:t(()=>[e(L,{modelValue:_.noteId,"onUpdate:modelValue":l[0]||(l[0]=o=>_.noteId=o),placeholder:"输入笔记ID",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(I,{label:"作者"},{default:t(()=>[e(L,{modelValue:_.author,"onUpdate:modelValue":l[1]||(l[1]=o=>_.author=o),placeholder:"输入作者昵称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(I,{label:"关键词"},{default:t(()=>[e(L,{modelValue:_.keyword,"onUpdate:modelValue":l[2]||(l[2]=o=>_.keyword=o),placeholder:"标题或内容关键词",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(I,{label:"日期范围"},{default:t(()=>[e(W,{modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=o=>y.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(I,null,{default:t(()=>[e(x,{type:"primary",onClick:q,loading:C.value},{default:t(()=>[e(n,null,{default:t(()=>[e(h(_e))]),_:1}),l[13]||(l[13]=d(" 查询 "))]),_:1,__:[13]},8,["loading"]),e(x,{onClick:G},{default:t(()=>[e(n,null,{default:t(()=>[e(h(ce))]),_:1}),l[14]||(l[14]=d(" 重置 "))]),_:1,__:[14]})]),_:1})]),_:1},8,["model"]),ue((k(),U(Z,{data:V.value,stripe:"",style:{width:"100%"},"row-key":"_id",onRowClick:O},{default:t(()=>[e(v,{prop:"noteId",label:"笔记ID",width:"180","show-overflow-tooltip":""},{default:t(({row:o})=>[e(R,{href:E(o.noteId),type:"primary",target:"_blank",onClick:l[4]||(l[4]=F(()=>{},["stop"]))},{default:t(()=>[d(i(o.noteId),1)]),_:2},1032,["href"])]),_:1}),e(v,{prop:"title",label:"标题/内容","min-width":"250","show-overflow-tooltip":""},{default:t(({row:o})=>[s("div",Me,i(o.title||o.noteContent||"无内容"),1)]),_:1}),e(v,{label:"作者ID",width:"180"},{default:t(({row:o})=>[s("div",Te,[e(n,{style:{"margin-right":"8px"}},{default:t(()=>[e(h(fe))]),_:1}),s("span",null,i(o.authorId||"未知作者"),1)])]),_:1}),e(v,{prop:"publishTime",label:"发布时间",width:"160"},{default:t(({row:o})=>[d(i(z(o.publishTime)),1)]),_:1}),e(v,{prop:"noteLike",label:"点赞数",width:"100",sortable:""},{default:t(({row:o})=>[e(b,{type:"success",size:"small"},{default:t(()=>[d(i(P(o.noteLike)),1)]),_:2},1024)]),_:1}),e(v,{prop:"noteCommitCount",label:"评论数",width:"100",sortable:""},{default:t(({row:o})=>[e(b,{type:"info",size:"small"},{default:t(()=>[d(i(P(o.noteCommitCount)),1)]),_:2},1024)]),_:1}),e(v,{prop:"fetchTimestamp",label:"抓取时间",width:"160"},{default:t(({row:o})=>[d(i(z(o.fetchTimestamp)),1)]),_:1}),e(v,{label:"操作",width:"120",fixed:"right"},{default:t(({row:o})=>[e(x,{type:"primary",size:"small",onClick:F(Re=>j(o),["stop"])},{default:t(()=>l[15]||(l[15]=[d(" 查看详情 ")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,C.value]]),e(ee,{style:{"margin-top":"20px",display:"flex","justify-content":"center"},background:"",layout:"total, sizes, prev, pager, next, jumper",total:f.total,"page-size":f.pageSize,"current-page":f.currentPage,"page-sizes":[10,20,50,100],onSizeChange:K,onCurrentChange:J},null,8,["total","page-size","current-page"])]),_:1}),e(te,{modelValue:D.value,"onUpdate:modelValue":l[6]||(l[6]=o=>D.value=o),title:"笔记详情",width:"800px","close-on-click-modal":!1},{footer:t(()=>[e(x,{onClick:l[5]||(l[5]=o=>D.value=!1)},{default:t(()=>l[17]||(l[17]=[d("关闭")])),_:1,__:[17]})]),default:t(()=>[r.value?(k(),M("div",Ue,[e($,{column:2,border:""},{default:t(()=>[e(m,{label:"笔记ID",span:2},{default:t(()=>[e(R,{href:E(r.value.noteId),type:"primary",target:"_blank"},{default:t(()=>[d(i(r.value.noteId),1)]),_:1},8,["href"])]),_:1}),e(m,{label:"内容",span:2},{default:t(()=>[d(i(r.value.noteContent||r.value.title||"无内容"),1)]),_:1}),e(m,{label:"作者ID"},{default:t(()=>[d(i(r.value.authorId||"未知"),1)]),_:1}),e(m,{label:"发布时间"},{default:t(()=>[d(i(z(r.value.publishTime)),1)]),_:1}),e(m,{label:"抓取时间"},{default:t(()=>[d(i(z(r.value.fetchTimestamp)),1)]),_:1}),e(m,{label:"点赞数"},{default:t(()=>[e(b,{type:"success"},{default:t(()=>[d(i(P(r.value.noteLike)),1)]),_:1})]),_:1}),e(m,{label:"评论数"},{default:t(()=>[e(b,{type:"info"},{default:t(()=>[d(i(P(r.value.noteCommitCount)),1)]),_:1})]),_:1}),e(m,{label:"数据库ID"},{default:t(()=>[e(b,{type:"primary"},{default:t(()=>[d(i(r.value._id),1)]),_:1})]),_:1})]),_:1}),r.value.illegal_info&&(r.value.illegal_info.illegal_type||r.value.illegal_info.illegal_text)?(k(),M("div",Be,[l[16]||(l[16]=s("h4",null,"违规信息",-1)),e($,{column:1,border:""},{default:t(()=>[r.value.illegal_info.illegal_type?(k(),U(m,{key:0,label:"违规类型"},{default:t(()=>[e(b,{type:"danger"},{default:t(()=>[d(i(r.value.illegal_info.illegal_type),1)]),_:1})]),_:1})):S("",!0),r.value.illegal_info.illegal_text?(k(),U(m,{key:1,label:"违规文本"},{default:t(()=>[d(i(r.value.illegal_info.illegal_text),1)]),_:1})):S("",!0)]),_:1})])):S("",!0)])):S("",!0)]),_:1},8,["modelValue"])])}}},Ae=ae(je,[["__scopeId","data-v-eb8524d1"]]);export{Ae as default};
