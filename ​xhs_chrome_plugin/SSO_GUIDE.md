# 小红书助手插件 SSO 登录使用指南

本指南将帮助您使用插件的单点登录(SSO)功能，无需在插件中直接输入账号密码即可登录API服务。

## 前提条件

1. 后端服务器已启用Keycloak SSO
2. 您已在Keycloak中注册了账号
3. 插件已正确配置API地址

## 使用步骤

### 1. 配置API地址

首先，您需要配置后端API地址：

1. 打开插件弹出窗口
2. 点击底部的"设置数据同步"链接
3. 在设置页面中填写API地址，如：`https://localhost:8000`
4. 点击"保存API地址"按钮

### 2. 使用SSO登录

#### 步骤一：发起SSO登录

1. 返回插件弹出窗口，您将看到蓝色的"单点登录(SSO)"按钮
2. 点击该按钮，插件将创建SSO会话并打开新标签页
3. 在新标签页中，您将进入Keycloak登录页面

#### 步骤二：在Keycloak中登录

1. 在Keycloak登录页面中输入您的账号和密码
2. 根据您的Keycloak配置，可能还需要提供二次验证码(OTP)
3. 点击"登录"按钮完成身份认证
4. 登录成功后，页面会显示"SSO登录成功"消息

#### 步骤三：完成授权

1. 返回插件弹出窗口
2. 点击绿色的"已完成登录，点击继续"按钮
3. 插件将检查您的登录状态，并获取访问令牌
4. 成功获取令牌后，您将看到"SSO登录成功！"提示

### 3. 验证登录状态

登录成功后：

1. 插件顶部的状态信息会更新为"API已配置: xxx... (已登录)"
2. 您可以开始使用"上传通知列表"和"上传推文评论"等功能
3. 您的数据将使用SSO登录获取的令牌发送到API服务器

## 故障排除

如果您在SSO登录过程中遇到问题，请尝试以下步骤：

1. **登录页面无法打开**
   - 检查您的网络连接
   - 确认API地址是否正确
   - 验证后端服务是否正常运行

2. **Keycloak登录成功，但插件显示"未完成登录"**
   - 检查是否成功点击了Keycloak登录页面的"登录"按钮
   - 返回插件并点击"重新发起SSO登录"按钮重试

3. **"已完成登录"按钮点击后出错**
   - 可能是会话已过期，尝试重新发起SSO登录
   - 检查网络连接是否良好

4. **"保存Token失败"错误**
   - 检查浏览器设置，确保允许插件存储数据
   - 重启浏览器后重试

## 注意事项

- SSO登录会话有效期为10分钟，请尽快完成登录流程
- 成功登录后，访问令牌将存储在浏览器的插件存储空间中
- 如需退出登录，请在设置页面点击"退出登录"按钮 